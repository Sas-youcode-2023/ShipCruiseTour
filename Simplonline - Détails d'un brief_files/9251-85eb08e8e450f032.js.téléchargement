"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9251],{29251:function(n,e,t){t.d(e,{Gb:function(){return Yn},ZP:function(){return ne}});var r=t(47568),i=t(26042),o=t(69396),a=t(10253),c=t(7297),l=t(29815),s=t(34051),u=t.n(s),d=t(85893),f=t(47533),m=t(67294),p=t(87536),h=t(26793),v=t(64508),g=t(73324),x=t(8773),b=t(16310),Z=t(47316),k=t(35019),w=t(59689),j=t(37264),C=t(24143),y=t(19324),I=t(76922),L=t(43517),S=t(11163),R=t(93463),P=t(99831),E=t(97196),T=t(72109);function A(){var n=(0,c.Z)(["\n    padding-left: ",";\n    padding-right: ",";\n    width: 100%;\n"]);return A=function(){return n},n}function V(){var n=(0,c.Z)(["\n    circle {\n        fill: ",";\n    }\n\n    path {\n        stroke: ",";\n    }\n"]);return V=function(){return n},n}function W(){var n=(0,c.Z)(["\n    circle {\n        fill: ",";\n        opacity: 1;\n    }\n    path {\n        stroke: ",";\n    }\n"]);return W=function(){return n},n}function _(){var n=(0,c.Z)(["\n    display: flex;\n"]);return _=function(){return n},n}function N(){var n=(0,c.Z)(["\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    border-radius: ",";\n    outline: none;\n    border: 1px solid ",";\n    padding: 10px ",";\n\n    button {\n        svg {\n            circle {\n                fill: transparent;\n            }\n            path {\n                stroke: ",";\n            }\n        }\n    }\n\n    "," {\n        --icon-color: ",";\n    }\n"]);return N=function(){return n},n}var D=(0,g.ZP)(I.xv).withConfig({componentId:"sc-c2f453-0"})(A(),(function(n){return n.theme.spacing[3]}),(function(n){return n.theme.spacing[5]})),M=(0,g.ZP)(T.oL).withConfig({componentId:"sc-c2f453-1"})(V(),(function(n){return n.theme.palette.red.base}),(function(n){return n.theme.palette.white.base})),O=(0,g.ZP)(T.XG).withConfig({componentId:"sc-c2f453-2"})(W(),(function(n){return n.theme.palette.green.base}),(function(n){return n.theme.palette.white.base})),F=g.ZP.div.withConfig({componentId:"sc-c2f453-3"})(_()),z=(0,g.ZP)((function(n){var e=n.title,t=n.onClick,r=n.isValid,i=n.className,o=(0,a.Z)((0,h.$)(),1)[0];return(0,d.jsxs)("div",{className:i,children:[(0,d.jsx)(F,{children:r?(0,d.jsx)(O,{}):(0,d.jsx)(M,{})}),(0,d.jsx)(D,{variant:"subheading",children:e}),(0,d.jsx)(E.hU,{variant:"secondary",onClick:t,title:o("component.listItem.close"),"aria-label":o("component.listItem.close"),children:(0,d.jsx)(k.X1,{})})]})})).withConfig({componentId:"sc-c2f453-4"})(N(),(function(n){return n.theme.shape.borderRadius.medium}),(function(n){return n.theme.palette.purple.lighter2}),(function(n){return n.theme.spacing[5]}),(function(n){return n.theme.palette.black.base}),k.le,(function(n){return n.theme.palette.black.base}));function U(){var n=(0,c.Z)(["\n    display: flex;\n    align-items: flex-end;\n"]);return U=function(){return n},n}function q(){var n=(0,c.Z)(["\n    display: flex;\n    flex-direction: column;\n    gap: ",";\n"]);return q=function(){return n},n}function $(){var n=(0,c.Z)(["\n    ","\n    width: 100%;\n    outline: none;\n    font-size: 14px;\n    resize: none;\n    border: none;\n    position: relative;\n    z-index: ",";\n    background: transparent;\n\n    &:valid + label,\n    &:focus + label {\n        display: none;\n    }\n\n    &:disabled {\n        cursor: not-allowed;\n    }\n"]);return $=function(){return n},n}function G(){var n=(0,c.Z)(["\n    position: relative;\n"]);return G=function(){return n},n}function K(){var n=(0,c.Z)(["\n            border: 2px solid ",";\n            padding: "," 17px;\n        "]);return K=function(){return n},n}function X(){var n=(0,c.Z)(["\n    position: relative;\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: ",";\n    border: ",";\n    border-radius: ",";\n    padding: ",";\n    margin-right: ",";\n    min-width: 0;\n    max-height: 273px;\n    overflow-y: auto;\n\n    ","\n\n    ","\n\n    &:focus-within {\n        outline: 3px solid ",";\n        outline-offset: 2px;\n    }\n"]);return X=function(){return n},n}function B(){var n=(0,c.Z)(["\n    font-weight: 600;\n    font-size: 10px;\n    line-height: 14px;\n"]);return B=function(){return n},n}function H(){var n=(0,c.Z)(["\n    margin: ",";\n    color: ",";\n    display: flex;\n    align-items: center;\n    transition: height ease 0.2s;\n    height: ",";\n    overflow: hidden;\n    --icon-color: ",";\n\n    > "," {\n        width: 13px;\n        height: 13px;\n        margin-right: ",";\n        background-color: ",";\n    }\n"]);return H=function(){return n},n}function Q(){var n=(0,c.Z)(["\n    display: flex;\n    align-items: center;\n    margin-bottom: ",";\n"]);return Q=function(){return n},n}function Y(){var n=(0,c.Z)(["\n    padding: ",";\n\n    "," {\n        --icon-color: ",";\n\n        &:hover {\n            --icon-color: ",";\n        }\n    }\n"]);return Y=function(){return n},n}var J=g.ZP.div.withConfig({componentId:"sc-226bf1e8-0"})(U()),nn=g.ZP.div.withConfig({componentId:"sc-226bf1e8-1"})(q(),(function(n){return n.theme.spacing[4]})),en=(0,g.ZP)(R.Z).withConfig({componentId:"sc-226bf1e8-2"})($(),(function(n){return n.theme.typography.p}),(function(n){return n.theme.zIndex.overlay})),tn=g.ZP.div.withConfig({componentId:"sc-226bf1e8-3"})(G()),rn=g.ZP.div.withConfig({componentId:"sc-226bf1e8-4"})(X(),(function(n){return n.theme.spacing[4]}),(function(n){var e=n.theme;return n.isError?"2px solid ".concat(e.palette.red.base):"1px solid ".concat(e.palette.grey.base)}),(function(n){return n.theme.shape.borderRadius.medium}),(function(n){var e=n.theme;return"".concat(e.spacing[3]," ").concat(e.spacing[5])}),(function(n){return n.theme.spacing[3]}),(function(n){var e=n.isDisabled,t=n.theme;return e?{backgroundColor:t.palette.grey.lightest,border:"2px solid ".concat(t.palette.red.base)}:{backgroundColor:"transparent"}}),(function(n){var e=n.isActivated,t=n.theme,r=n.isError;return!e&&(0,g.iv)(K(),r?t.palette.red.base:t.palette.purple.base,(function(n){return n.theme.spacing[3]}))}),(function(n){return n.theme.palette.blue.focus})),on=(0,g.ZP)(I.xv).withConfig({componentId:"sc-226bf1e8-5"})(B()),an=(0,g.ZP)(on).withConfig({componentId:"sc-226bf1e8-6"})(H(),(function(n){var e=n.isOpen,t=n.theme;return e?"0 0 0 ".concat(t.spacing[3]):"0"}),(function(n){return n.theme.palette.red.base}),(function(n){var e=n.isOpen,t=n.theme;return e?t.spacing[5]:0}),(function(n){return n.theme.palette.red.base}),k.le,(function(n){return n.theme.spacing[3]}),(function(n){return n.theme.palette.red.lightest})),cn=g.ZP.div.withConfig({componentId:"sc-226bf1e8-7"})(Q(),(function(n){return n.theme.spacing[1]}));var ln=(0,g.ZP)((function(n){var e,t=n.isLearnerActive,r=void 0===t||t,o=n.className,c=n.disabled,l=void 0!==c&&c,s=(0,a.Z)((0,h.$)(),1)[0],u="true"===(0,S.useRouter)().query.focus,f=(0,m.useState)(u),v=f[0],g=f[1],x=(0,p.Gc)(),b=x.watch,Z=x.setValue,w=x.formState,j=w.errors,C=w.isSubmitting,y=x.control,I=b("isReview")?b("skillLevelValidations"):[];return(0,m.useEffect)((function(){return document.addEventListener("invalid",(function(n){n.preventDefault()}),!0),function(){document.removeEventListener("invalid",(function(n){return n.preventDefault()}))}})),(0,d.jsx)("div",{className:o,children:(0,d.jsxs)("div",{children:[(0,d.jsxs)(cn,{children:[(0,d.jsx)(on,{as:"label",htmlFor:"inputMessage",children:s("page.corrections.messaging.label")}),(0,d.jsxs)(an,{isOpen:!!j.message,children:[(0,d.jsx)(k.jj,{}),s("form.errors."+(null===(e=j.message)||void 0===e?void 0:e.type))]})]}),(0,d.jsxs)(J,{children:[(0,d.jsxs)(rn,{isDisabled:!r,isActivated:!v,isError:!!j.message||!!j.learnerLinks||!r,children:[I&&(0,d.jsx)(nn,{children:I.map((function(n){return(0,d.jsx)(z,{title:n.title,isValid:n.valid,onClick:function(){return e=n.id,Z("skillLevelValidations",null===I||void 0===I?void 0:I.filter((function(n){return n.id!==e})));var e}},n.id)}))}),(0,d.jsx)(tn,{children:(0,d.jsx)(p.Qr,{name:"message",control:y,render:function(n){var e=n.field;return(0,d.jsx)(en,(0,i.Z)({id:"inputMessage","aria-disabled":!r,disabled:!r,onClick:function(){return g(!0)},maxRows:19,placeholder:s("page.corrections.messaging.labelTextarea")},e))}})})]}),(0,d.jsxs)(E.hU,{type:"submit",loading:C,disabled:l,size:"large",children:[(0,d.jsx)(P.Z,{children:s("page.corrections.messaging.submit")}),C?(0,d.jsx)(k.gb,{}):(0,d.jsx)(k.c5,{})]})]})]})})})).withConfig({componentId:"sc-226bf1e8-8"})(Y(),(function(n){var e=n.theme;return"".concat(e.spacing[3]," ").concat(e.spacing[7]," ").concat(e.spacing[5])}),E.hU,(function(n){return n.theme.palette.grey.base}),(function(n){return n.theme.palette.white.base})),sn=t(83195),un=t(41664),dn=t.n(un),fn=t(82383),mn=t(99534),pn=t(48380),hn=t(6719),vn=t(62674),gn=t(20121),xn=t(7686),bn=t(21049);function Zn(){var n=(0,c.Z)([""]);return Zn=function(){return n},n}var kn=(0,g.ZP)((function(n){var e=n.learner,t=n.skillLevels,r=void 0===t?[]:t,a=n.works,c=void 0===a?[]:a,l=(0,mn.Z)(n,["learner","skillLevels","works"]),s=(0,pn.z)().user;return(0,d.jsx)(vn.Z,(0,o.Z)((0,i.Z)({},l),{children:c.flatMap((function(n){var t,i,o=n.trainer,a=n.trainerComment,c=n.trainerDatetime,l=n.learnerComment,u=n.learnerDatetime,f=n.learnerLinks,m=n.mediaSecured,p=n.unvalidatedSkillLevels,h=n.validatedSkillLevels,v=[];if(a){var g=(0,bn.L)(r,h,p);v.push((0,d.jsx)(gn.Z,{user:o,date:new Date(c),message:a,variant:(0,w.sR)(o)===(0,w.sR)(s)?"owner":"other",children:g.length>0?g.map((function(n){var e=n.id,t=n.title,r=n.level,i=n.valid;return(0,d.jsx)(xn.Z,{title:t,level:r,variant:i?"success":"danger"},e)})):null},"".concat(n["@id"],"_trainer")))}l&&v.push((0,d.jsxs)(gn.Z,{user:e,date:new Date(u),message:l,variant:(0,w.sR)(e)===(0,w.sR)(s)?"owner":"other",children:[(null!==(t=null===f||void 0===f?void 0:f.length)&&void 0!==t?t:0)>0?f.map((function(n){var e=n.url;return(0,d.jsx)(hn.Z,{kind:"link",url:e},e)})):null,(null!==(i=null===m||void 0===m?void 0:m.length)&&void 0!==i?i:0)>0?m.map((function(n){var e=n.url,t=n.title,r=n.size;return(0,d.jsx)(hn.Z,{kind:"media",url:e,title:t,size:r},e)})):null]},"".concat(n["@id"],"_learner")));return v}))}))})).withConfig({componentId:"sc-a01e0fc-0"})(Zn());function wn(){var n=(0,c.Z)(["\n    color: ",";\n    outline-color: ",";\n"]);return wn=function(){return n},n}function jn(){var n=(0,c.Z)(["\n    padding: ",";\n"]);return jn=function(){return n},n}function Cn(){var n=(0,c.Z)(["\n    overflow-y: scroll;\n    padding: ",";\n    padding-right: ",";\n    margin-right: ",";\n    width: 100%;\n"]);return Cn=function(){return n},n}function yn(){var n=(0,c.Z)(["\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n\n    "," {\n        flex: 1;\n        min-height: 0;\n    }\n"]);return yn=function(){return n},n}var In=(0,g.ZP)(I.xv).withConfig({componentId:"sc-c479ab9d-0"})(wn(),(function(n){return n.theme.palette.purple.base}),(function(n){return n.theme.palette.blue.focus})),Ln=g.ZP.div.withConfig({componentId:"sc-c479ab9d-1"})(jn(),(function(n){var e=n.theme;return"".concat(e.spacing[6]," ").concat(e.spacing[7]," ").concat(e.spacing[5]," ").concat(e.spacing[7])})),Sn=g.ZP.div.withConfig({componentId:"sc-c479ab9d-2"})(Cn(),(function(n){var e=n.theme;return"0  ".concat(e.spacing[7]," ").concat(e.spacing[5])}),(function(n){var e=n.theme;return"calc(".concat(e.spacing[7]," - ").concat(e.spacing[2],")")}),(function(n){return n.theme.spacing[2]})),Rn=(0,g.ZP)((function(n){var e=n.topic,t=n.title,r=n.skillLevels,i=n.className,o=(0,m.useRef)(null),a=(0,m.useRef)(null);return(0,m.useEffect)((function(){var n;null===o||void 0===o||null===(n=o.current)||void 0===n||n.scrollTo(0,o.current.scrollHeight)}),[null===o||void 0===o?void 0:o.current,e.works.length]),(0,m.useEffect)((function(){a&&a.current&&a.current.focus()}),[a]),(0,d.jsxs)("div",{className:i,children:[(0,d.jsx)(Ln,{children:(0,d.jsx)(dn(),{href:fn.AW.BRIEFS_DETAILS,as:e.brief,passHref:!0,children:(0,d.jsx)(In,{ref:a,as:"a",variant:"h3",children:t})})}),(0,d.jsx)(Sn,{ref:o,children:(0,d.jsx)(kn,{works:e.works,learner:e.learner,skillLevels:r})})]})})).withConfig({componentId:"sc-c479ab9d-3"})(yn(),Sn),Pn=t(77229);function En(){var n=(0,c.Z)(["\n    color: ",";\n"]);return En=function(){return n},n}function Tn(){var n=(0,c.Z)(["\n    padding: ",";\n    margin: "," 0;\n\n    background-color: ",";\n    border-radius: ",";\n"]);return Tn=function(){return n},n}function An(){var n=(0,c.Z)(["\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    padding: ",";\n"]);return An=function(){return n},n}var Vn=(0,g.ZP)(I.xv).withConfig({componentId:"sc-a4d67fae-0"})(En(),(function(n){return n.theme.palette.purple.base})),Wn=g.ZP.div.withConfig({componentId:"sc-a4d67fae-1"})(Tn(),(function(n){return n.theme.spacing[4]}),(function(n){return n.theme.spacing[6]}),(function(n){return n.theme.palette.grey.lightest}),(function(n){return n.theme.shape.borderRadius.medium})),_n=(0,g.ZP)((function(n){var e=n.children,t=n.briefTitle,r=n.component,i=n.className,o=(0,a.Z)((0,h.$)(),1)[0];return(0,d.jsxs)("div",{className:i,children:[(0,d.jsx)(Z.od,{feature:Z.L0.TOPICS_WORK_SUBMIT,children:(0,d.jsxs)(I.xv,{as:"h4",variant:"label",children:[o("component.".concat(r,".title")),(0,d.jsx)(Vn,{as:"span",variant:"label",children:t})]})}),(0,d.jsx)(Wn,{children:(0,d.jsx)(I.xv,{children:o("component.".concat(r,".subtitle"))})}),e]})})).withConfig({componentId:"sc-a4d67fae-2"})(An(),(function(n){var e=n.theme;return"".concat(e.spacing[6]," ").concat(e.spacing[5])})),Nn=t(89431);function Dn(){var n=(0,c.Z)(["\n    flex: 1;\n    padding: 0;\n\n    & > li {\n        list-style: none;\n    }\n"]);return Dn=function(){return n},n}function Mn(){var n=(0,c.Z)(["\n    width: auto;\n    margin-right: auto;\n"]);return Mn=function(){return n},n}var On=g.ZP.ul.withConfig({componentId:"sc-d5385840-0"})(Dn()),Fn=(0,g.ZP)(Pn.ZP).withConfig({componentId:"sc-d5385840-1"})(Mn()),zn=function(n){var e=n.briefTitle,t=n.skillLevels,r=n.readOnly,i=void 0!==r&&r,o=(0,a.Z)((0,h.$)(),1)[0],c=(0,p.Gc)(),s=c.setValue,u=(0,c.watch)("skillLevelValidations"),f=(0,m.useState)(u||[]),v=f[0],g=f[1];(0,m.useEffect)((function(){g(u||[])}),[u]);var x=(0,m.useCallback)((function(n,e,t){return g((function(r){return(0,l.Z)(r.filter((function(e){return e.id!==n}))).concat([{title:"".concat(t.skill.officialTitle," - ").concat(o("page.corrections.messaging.level",{skillLevelNumber:t.level})),id:n,valid:e}])}))}),[]);return(0,d.jsxs)(_n,{briefTitle:e,component:"skillLevelsReview",children:[(0,d.jsx)(On,{children:t.map((function(n){var e=v.find((function(e){return e.id===n["@id"]})),t="".concat(n.skill.officialTitle," - ").concat(o("page.corrections.messaging.level",{skillLevelNumber:n.level}));return(0,d.jsx)("li",{children:(0,d.jsx)(Nn.Z,{id:n["@id"],title:t,value:e&&e.valid,onValidChange:i?void 0:function(e,t){return x(e,t,n)},readOnly:i})},n["@id"])}))}),!i&&(0,d.jsx)(Fn,{type:"button",variant:"success",outlined:!0,onClick:function(){s("isReview",!0),s("skillLevelValidations",v)},disabled:0===v.length,children:o("page.corrections.validateReview")})]})};function Un(){var n=(0,c.Z)(["\n    flex: 1;\n    padding: 0;\n\n    & > li {\n        list-style: none;\n    }\n"]);return Un=function(){return n},n}var qn=g.ZP.ul.withConfig({componentId:"sc-7159e879-0"})(Un()),$n=function(n){var e=n.briefTitle,t=n.skillLevels,r=(0,a.Z)((0,h.$)(),1)[0],i=(0,(0,p.Gc)().watch)("skillLevelValidations");return(0,d.jsx)(_n,{briefTitle:e,component:"skillLevelsInfos",children:(0,d.jsx)(qn,{children:t.map((function(n){var e=null===i||void 0===i?void 0:i.find((function(e){return e.id===n["@id"]}));return(0,d.jsx)("li",{children:(0,d.jsx)(Nn.Z,{id:n["@id"],title:"".concat(n.skill.officialTitle," - ").concat(r("page.corrections.messaging.level",{skillLevelNumber:n.level})),value:e&&e.valid,readOnly:!0})},n["@id"])}))})})},Gn=t(20876);function Kn(){var n=(0,c.Z)(["\n    display: flex;\n    flex-direction: column;\n"]);return Kn=function(){return n},n}function Xn(){var n=(0,c.Z)(["\n    height: 100%;\n    width: 100%;\n\n    display: flex;\n    flex-direction: column;\n\n    "," {\n        flex: 1;\n        min-height: 0;\n    }\n"]);return Xn=function(){return n},n}function Bn(){var n=(0,c.Z)([""]);return Bn=function(){return n},n}var Hn=g.ZP.form.withConfig({componentId:"sc-b9c3ed32-0"})(Kn()),Qn=g.ZP.div.withConfig({componentId:"sc-b9c3ed32-1"})(Xn(),Rn),Yn=5,Jn=b.Ry().shape({skillLevelValidations:b.IX(),isReview:b.O7(),message:b.Z_().required(),workUrl:b.Z_().url()}).required(),ne=(0,g.ZP)((function(n){var e=n.selectedTopic,t=n.isTrainer,c=n.onSubmitSuccess,s=n.className,g=(0,m.useState)(!1),b=g[0],S=g[1],R=(0,Z.o_)(),P=R(Z.L0.TOPICS_WORK_EVAL),E=!R(Z.L0.SELECT_ACTIVE_CLASSROOM),T=(0,p.cI)({resolver:(0,f.X)(Jn),defaultValues:{skillLevelValidations:[],isReview:!1}}),A=function(n){return T.setValue("message",n)},V=(0,a.Z)((0,h.$)(),1)[0];(0,m.useEffect)((function(){T.register("skillLevelValidations"),T.register("isReview")}),[T.register]),(0,m.useEffect)((function(){T.reset({isReview:!1,skillLevelValidations:[],message:""})}),[e]);var W=(0,v.aM)(e["@id"]),_=W.data,N=W.isLoading,D=W.refetch,M=_,O=(null===M||void 0===M?void 0:M.works)||[],F=null===M||void 0===M?void 0:M.lastRenderedWork,z=(0,w.bV)({brief:null===M||void 0===M?void 0:M.brief}),U=z.data,q=z.isLoading;(0,m.useEffect)((function(){var n=(0,l.Z)(O).reverse().find((function(n){return n.status===C.Wv.CORRECTED}));if(n&&U){var e=U.skillLevels,t=n.validatedSkillLevels.map((function(n){var t=e.find((function(e){return e["@id"]===n}));return t?{id:t["@id"],title:"".concat(t.skill.officialTitle," - ").concat(V("page.corrections.messaging.level",{skillLevelNumber:t.level})),valid:!0}:null})).filter((function(n){return null!==n})),r=n.unvalidatedSkillLevels.map((function(n){var t=e.find((function(e){return e["@id"]===n}));return t?{id:t["@id"],title:"".concat(t.skill.officialTitle," - ").concat(V("page.corrections.messaging.level",{skillLevelNumber:t.level})),valid:!1}:null})).filter((function(n){return null!==n}));setTimeout((function(){var n;n=(0,l.Z)(t).concat((0,l.Z)(r)),T.setValue("skillLevelValidations",n)}))}}),[U,O,M]);var $=(0,m.useMemo)((function(){return{method:"PUT",url:(null===M||void 0===M?void 0:M.lastRenderedWork)&&(null===M||void 0===M?void 0:M.lastRenderedWork["@id"])}}),[M]),G=(0,y.Z)($).request,K=(0,m.useMemo)((function(){return{method:"POST",url:"/works"}}),[]),X=(0,y.Z)(K),B=X.request,H=X.isPending,Q=(0,m.useCallback)(T.handleSubmit(function(){var n=(0,r.Z)(u().mark((function n(e){var t,r;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.isReview){n.next=7;break}return n.next=4,G({data:{validatedSkillLevels:null===(t=e.skillLevelValidations)||void 0===t?void 0:t.filter((function(n){return!0===n.valid})).map((function(n){return n.id})),unvalidatedSkillLevels:null===(r=e.skillLevelValidations)||void 0===r?void 0:r.filter((function(n){return!1===n.valid})).map((function(n){return n.id})),trainerComment:e.message}});case 4:T.setValue("isReview",!1),n.next=9;break;case 7:return n.next=9,B({data:{uuid:(0,x.Z)(),topic:M&&M["@id"],trainerComment:e.message}});case 9:D(),c&&c(),A("");case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),[M,O]),Y=(0,m.useCallback)(T.handleSubmit(function(){var n=(0,r.Z)(u().mark((function n(e){var t;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.message,n.next=3,B({data:{uuid:(0,x.Z)(),topic:null===M||void 0===M?void 0:M["@id"],learnerComment:t}});case 3:c&&c(),D(),A("");case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),[M]),J=(null===F||void 0===F?void 0:F.status)===C.Wv.NONCORRECTED;return N||q||!U||!M?null:(0,d.jsx)(L.Z,{className:s,aside:(0,d.jsx)(p.RV,(0,o.Z)((0,i.Z)({},T),{children:t?(0,d.jsx)(zn,{readOnly:!J||!P,briefTitle:U.title,skillLevels:U.skillLevels}):(0,d.jsx)($n,{briefTitle:U.title,skillLevels:U.skillLevels})})),children:(0,d.jsx)(Qn,{children:(0,d.jsxs)(p.RV,(0,o.Z)((0,i.Z)({},T),{children:[(0,d.jsx)(Rn,{topic:M,title:U.title,skillLevels:U.skillLevels}),(0,d.jsx)(Hn,{onSubmit:t||E?Q:Y,children:(0,d.jsx)(Z.od,{features:[Z.L0.TOPICS_WORK_EVAL,Z.L0.TOPICS_WORK_SUBMIT,Z.L0.TOPICS_MESSAGE],children:t||E?(0,d.jsx)(ln,{isLearnerActive:t?!!e.learnerInClassroom:void 0,disabled:H}):(0,d.jsx)(Gn.Z,{header:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(j.zx,{type:"button",small:!0,filled:!0,variant:"primary",onClick:function(){return S(!0)},children:[V("component.WorkMessageForm.addWorkAttachment")," ",(0,d.jsx)(k.v3,{})]}),(0,d.jsx)(I.xv,{variant:"subheading",children:V("component.WorkMessageForm.addWorkAttachmentLabel")})]})})})}),(0,d.jsx)(sn.Z,{visible:b,onCancel:function(){return S(!1)},onSuccess:function(){S(!1),D()},type:"individual",workspaceId:(0,w.sR)(M)})]}))})})})).withConfig({componentId:"sc-b9c3ed32-2"})(Bn())},20876:function(n,e,t){var r=t(26042),i=t(69396),o=t(99534),a=t(10253),c=t(7297),l=t(85893),s=(t(67294),t(87536)),u=t(26793),d=t(76922),f=t(73324),m=t(35019),p=t(37264);function h(){var n=(0,c.Z)(["\n    display: flex;\n    align-items: center;\n    border-radius: ",";\n    border-bottom: 1px solid ",";\n    padding: ",";\n\n    "," {\n        margin-left: ",";\n        --text-color: ",";\n    }\n"]);return h=function(){return n},n}function v(){var n=(0,c.Z)(["\n    display: flex;\n    align-items: end;\n    padding: ",";\n    gap: ",";\n\n    "," {\n        flex: 1;\n    }\n"]);return v=function(){return n},n}function g(){var n=(0,c.Z)(["\n    display: flex;\n    flex-direction: column;\n    border-radius: ",";\n\n    background-color: ",";\n"]);return g=function(){return n},n}var x=f.ZP.div.withConfig({componentId:"sc-2cffa2d1-0"})(h(),(function(n){var e=n.theme;return"".concat(e.shape.borderRadius.medium," ").concat(e.shape.borderRadius.medium," 0 0")}),(function(n){return n.theme.palette.purple.lighter}),(function(n){var e=n.theme;return"".concat(e.spacing[4]," ").concat(e.spacing[5]," ").concat(e.spacing[3]," ").concat(e.spacing[5])}),d.xv,(function(n){return n.theme.spacing[5]}),(function(n){return n.theme.palette.grey.base})),b=f.ZP.div.withConfig({componentId:"sc-2cffa2d1-1"})(v(),(function(n){var e=n.theme;return"".concat(e.spacing[3]," ").concat(e.spacing[5]," ").concat(e.spacing[5])}),(function(n){return n.theme.spacing[3]}),p.SR);e.Z=(0,f.ZP)((function(n){var e=n.header,t=(0,o.Z)(n,["header"]),c=(0,a.Z)((0,u.$)(),1)[0],d=(0,s.Gc)().formState.isSubmitting;return(0,l.jsxs)("div",(0,i.Z)((0,r.Z)({},t),{children:[e&&(0,l.jsx)(x,{children:e}),(0,l.jsxs)(b,{children:[(0,l.jsx)(s.Qr,{name:"message",render:function(n){var e=n.field,t=n.fieldState,o=t.invalid,a=t.error,s=e.name;return(0,l.jsx)(p.SR,{small:!0,required:!0,htmlFor:s,label:c("component.WorkMessageForm.textInput.label"),error:a,children:function(n){var t=n.errorId;return(0,l.jsx)("div",{children:(0,l.jsx)(p.oi,(0,i.Z)((0,r.Z)({},e),{id:s,disabled:d,"aria-describedby":t,"aria-invalid":o,variant:o?"error":"default",placeholder:c("component.WorkMessageForm.textInput.placeholder")}))})}})}}),(0,l.jsx)(p.hU,{type:"submit","aria-label":c("component.WorkMessageForm.submit"),size:"large",disabled:d,children:(0,l.jsx)(m.c5,{})})]})]}))})).withConfig({componentId:"sc-2cffa2d1-2"})(g(),(function(n){var e=n.theme;return"".concat(e.shape.borderRadius.medium," ").concat(e.shape.borderRadius.medium," 0 0")}),(function(n){return n.theme.palette.purple.lightest}))},83195:function(n,e,t){t.d(e,{Z:function(){return nn}});var r=t(47568),i=t(10253),o=t(7297),a=t(34051),c=t.n(a),l=t(85893),s=t(26793),u=t(76922),d=t(73324),f=t(8773),m=t(59689),p=t(64508),h=t(602),v=t(4874),g=t(3629),x=t(26042),b=t(69396),Z=t(29815),k=t(47533),w=t(67294),j=t(87536),C=t(16310),y=t(35019),I=t(37264),L=t(99968);function S(){var n=(0,o.Z)(["\n    display: flex;\n    align-items: center;\n    flex-grow: 1;\n    height: 28px;\n    box-sizing: border-box;\n    border: ",";\n    border-radius: ",";\n    padding: ",";\n    white-space: nowrap;\n    min-width: 0;\n\n    "," {\n        height: 16px;\n        width: 16px;\n        flex-shrink: 0;\n    }\n\n    &:focus {\n        outline: none;\n        box-shadow: 0 0 0 4px ",";\n    }\n"]);return S=function(){return n},n}function R(){var n=(0,o.Z)(["\n    margin-left: ",";\n    overflow: hidden;\n    text-overflow: ellipsis;\n"]);return R=function(){return n},n}function P(){var n=(0,o.Z)(["\n    margin-left: ",";\n    color: ",";\n"]);return P=function(){return n},n}function E(){var n=(0,o.Z)(["\n    text-transform: lowercase;\n    text-decoration: underline;\n    color: ",";\n"]);return E=function(){return n},n}function T(){var n=(0,o.Z)(["\n    display: flex;\n    align-items: center;\n    flex-wrap: nowrap;\n\n    "," {\n        margin-left: ",";\n\n        "," {\n            height: 24px;\n            width: 24px;\n        }\n    }\n"]);return T=function(){return n},n}var A=d.ZP.div.withConfig({componentId:"sc-a791de66-0"})(S(),(function(n){var e=n.theme;return"1px solid ".concat(e.palette.grey.lightest)}),(function(n){return n.theme.shape.borderRadius.medium}),(function(n){return n.theme.spacing[3]}),y.le,(function(n){return n.theme.palette.purple.light})),V=(0,d.ZP)(u.xv).withConfig({componentId:"sc-a791de66-1"})(R(),(function(n){return n.theme.spacing[2]})),W=(0,d.ZP)(u.xv).withConfig({componentId:"sc-a791de66-2"})(P(),(function(n){return n.theme.spacing[4]}),(function(n){return n.theme.palette.grey.base})),_=(0,d.ZP)(V).withConfig({componentId:"sc-a791de66-3"})(E(),(function(n){return n.theme.palette.purple.base})),N=(0,d.ZP)((function(n){var e=n.item,t=n.onDelete,r=n.className,o=(0,i.Z)((0,s.$)(),1)[0],a=function(n){var e=n.kind,t=n.title,r=n.size;switch(e){case"link":return(0,l.jsxs)(A,{as:"a",href:t,target:"_blank",rel:"noopener noreferrer",children:[(0,l.jsx)(y.rU,{}),(0,l.jsx)(_,{variant:"subheading",children:t})]});case"media":return(0,l.jsxs)(A,{children:[(0,l.jsx)(y.pk,{}),(0,l.jsx)(V,{variant:"subheading",children:t}),r&&(0,l.jsxs)(W,{variant:"subheading",as:"span",children:[r/1e6," Mo"]})]});default:throw new Error("Attachment kind property invalid")}}(e),c=e.title;return(0,l.jsxs)("div",{className:r,children:[a,t&&(0,l.jsxs)(I.hU,{variant:"secondary",type:"button",onClick:t,children:[(0,l.jsx)(y.ZN,{}),(0,l.jsx)(u.ys,{children:o("component.WorkElement.deleteItemSrOnly",{item:c})})]})]})})).withConfig({componentId:"sc-a791de66-4"})(T(),I.hU,(function(n){return n.theme.spacing[3]}),y.le);function D(){var n=(0,o.Z)(["\n    margin-top: ",";\n    display: flex;\n    justify-content: space-between;\n"]);return D=function(){return n},n}function M(){var n=(0,o.Z)(["\n    display: flex;\n    justify-content: center;\n    background-color: ",";\n    border-radius: ",";\n    padding: ",";\n    margin-top: ",";\n"]);return M=function(){return n},n}function O(){var n=(0,o.Z)(["\n    color: ",";\n"]);return O=function(){return n},n}function F(){var n=(0,o.Z)(["\n    --text-color: ",";\n    --icon-color: ",";\n    --icon-bg-color: ",";\n\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: ",";\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    max-width: 100%;\n"]);return F=function(){return n},n}function z(){var n=(0,o.Z)(["\n    "," {\n        margin-top: ",";\n    }\n\n    "," {\n        margin-top: ",";\n    }\n\n    "," {\n        max-height: 122px;\n    }\n"]);return z=function(){return n},n}var U=d.ZP.div.withConfig({componentId:"sc-d30dda1b-0"})(D(),(function(n){return n.theme.spacing[6]})),q=d.ZP.div.withConfig({componentId:"sc-d30dda1b-1"})(M(),(function(n){return n.theme.palette.grey.lightest}),(function(n){return n.theme.shape.borderRadius.medium}),(function(n){return n.theme.spacing[4]}),(function(n){return n.theme.spacing[3]})),$=(0,d.ZP)(u.xv).withConfig({componentId:"sc-d30dda1b-2"})(O(),(function(n){return n.theme.palette.grey.base})),G=(0,d.ZP)(u.xv).withConfig({componentId:"sc-d30dda1b-3"})(F(),(function(n){return n.theme.palette.red.base}),(function(n){return n.theme.palette.red.base}),(function(n){return n.theme.palette.red.lightest}),(function(n){return n.theme.spacing[3]})),K=C.Ry().shape({message:C.Z_().max(500).required(),workElements:C.IX().min(1).required()}).required(),X=(0,d.ZP)((function(n){var e=n.onSubmit,t=n.onClose,r=n.className,o=(0,i.Z)((0,s.$)(),1)[0],a=(0,j.cI)({mode:"onChange",criteriaMode:"firstError",defaultValues:{message:"",workElements:[]},resolver:(0,k.X)(K)}),c=a.control,u=a.watch,d=a.setValue,f=a.register,p=a.handleSubmit,h=a.formState,v=h.isSubmitting,g=h.errors,C=u("workElements"),S=C.map((function(n){var e,t=n["@type"]===m.DC.MEDIA&&n.type===m.DD.URL;return{id:n["@id"],kind:t?"link":"media",title:null!==(e=n.title)&&void 0!==e?e:n.url,url:n.url,size:n.size}}));(0,w.useEffect)((function(){f("workElements")}),[]);return(0,l.jsxs)("div",{className:r,children:[(0,l.jsx)(L.Z,{resources:C,onResourceAdd:function(n){d("workElements",(0,Z.Z)(C).concat([n]))},isMediaSecured:!0}),(0,l.jsxs)("form",{onSubmit:p(e),children:[(0,l.jsx)(I.SR,{required:!0,label:o("component.WorkAttachmentForm.addedAttachmentsLabel"),helper:"".concat(o("component.WorkAttachmentForm.maximumLinks",{maxCount:5})," - ").concat(o("component.WorkAttachmentForm.maximumAttachments",{maxCount:5})),children:function(){return(0,l.jsxs)(l.Fragment,{children:[S&&S.length>0?S.map((function(n){return(0,l.jsx)(N,{item:n,onDelete:function(){d("workElements",C.filter((function(e){var t=e.title;return n.title!==t})))}},n.id)})):(0,l.jsx)(q,{children:(0,l.jsx)($,{children:o("component.WorkAttachmentForm.noElementsMessage")})}),C.length<1&&g&&g.workElements&&(0,l.jsxs)(G,{id:"workElementsErrors",children:[(0,l.jsx)(y.jj,{size:16,circle:!0}),(0,l.jsx)("span",{children:g.workElements.message})]})]})}}),(0,l.jsx)(j.Qr,{control:c,name:"message",render:function(n){var e=n.field,t=n.fieldState,r=t.invalid,i=t.error,a=e.name;return(0,l.jsx)(I.SR,{required:!0,htmlFor:a,label:o("component.WorkAttachmentForm.messageLabel"),helper:o("component.WorkAttachmentForm.messageHelper",{count:e.value.length}),error:i,children:function(n){var t=n.errorId;return(0,l.jsx)(I.Kx,(0,b.Z)((0,x.Z)({minRows:4},e),{id:a,disabled:v,"aria-describedby":t,"aria-invalid":r,variant:r?"error":"default",placeholder:o("component.WorkAttachmentForm.messagePlaceholder")}))}})}}),(0,l.jsxs)(U,{children:[(0,l.jsx)(I.gh,{type:"button",onClick:t,disabled:v,children:o("component.WorkAttachmentForm.closeModal")}),(0,l.jsxs)(I.zx,{type:"submit",variant:"primary",filled:!0,disabled:v,children:[v&&(0,l.jsx)(y.aN,{}),!v&&o("component.WorkAttachmentForm.submitWork"),!v&&(0,l.jsx)(y.c5,{})]})]})]})]})})).withConfig({componentId:"sc-d30dda1b-4"})(z(),N,(function(n){return n.theme.spacing[2]}),I.SR,(function(n){return n.theme.spacing[5]}),I.Kx);function B(){var n=(0,o.Z)(["\n    > "," {\n        width: 832px;\n        margin: ",";\n        max-height: ",";\n        overflow-y: auto;\n    }\n"]);return B=function(){return n},n}function H(){var n=(0,o.Z)(["\n    margin-bottom: ",";\n"]);return H=function(){return n},n}function Q(){var n=(0,o.Z)([""]);return Q=function(){return n},n}var Y=(0,d.ZP)(g.Z).withConfig({componentId:"sc-ef29501b-0"})(B(),g.Y,(function(n){var e=n.theme;return"".concat(e.spacing[5]," auto")}),(function(n){var e=n.theme;return"calc(100vh - ".concat(e.spacing[6],")")})),J=(0,d.ZP)(u.xv).withConfig({componentId:"sc-ef29501b-1"})(H(),(function(n){return n.theme.spacing[5]})),nn=(0,d.ZP)((function(n){var e=n.type,t=n.workspaceId,o=n.onCancel,a=n.onSuccess,u=n.visible,d=n.className,g=(0,i.Z)((0,s.$)(),1)[0],x=(0,i.Z)(function(n){var e=(0,h.Z)(),t=function(){var n=(0,r.Z)(c().mark((function n(t){var r,i,o,a,l;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.uuid,i=t.topic,o=t.learnerComment,a=t.learnerLinks,l=t.mediaSecured,n.abrupt("return",e.post("/works",{uuid:r,topic:i,learnerComment:o,learnerLinks:a,mediaSecured:l.map((function(n){return"/media_secureds/".concat(n)}))}));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,p.Db)(t,n)}(),2),b=x[0],Z=x[1],k=Z.error,w=Z.reset,j=(0,i.Z)(function(n){var e=(0,h.Z)(),t=function(){var n=(0,r.Z)(c().mark((function n(t){var r,i,o,a,l;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.uuid,i=t.groupSpace,o=t.comment,a=t.links,l=t.mediaSecured,n.abrupt("return",e.post("/group_works",{uuid:r,groupSpace:i,comment:o,links:a,mediaSecured:l.map((function(n){return"/media_secureds/".concat(n)}))}));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,p.Db)(t,n)}(),2),C=j[0],y=j[1],I=y.error,L=y.reset,S=function(){var n=(0,r.Z)(c().mark((function n(r){var i,o,l,s,u,d,p,h;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=r.message,!((o=r.workElements).length<1)){n.next=3;break}return n.abrupt("return");case 3:return l=null===o||void 0===o?void 0:o.filter((function(n){return n["@type"]===m.DC.MEDIA_SECURED})),s=o.filter((function(n){return n["@type"]===m.DC.MEDIA&&n.type===m.DD.URL})),u=null,"individual"===e&&(u=b({uuid:(0,f.Z)(),topic:"/topics/".concat(t),learnerComment:i,learnerLinks:null===s||void 0===s?void 0:s.map((function(n){return{url:null!==(d=n.title)&&void 0!==d?d:n.url}})),mediaSecured:null===l||void 0===l?void 0:l.map((function(n){return(0,m.sR)(n)}))})),"group"===e&&(u=C({uuid:(0,f.Z)(),comment:i,groupSpace:"/group_spaces/".concat(t),links:null===s||void 0===s?void 0:s.map((function(n){return{url:null!==(p=n.title)&&void 0!==p?p:n.url}})),mediaSecured:null===l||void 0===l?void 0:l.map((function(n){return(0,m.sR)(n)}))})),n.next=10,u;case 10:return h=n.sent,a(),n.abrupt("return",h);case 13:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,l.jsxs)(Y,{visible:u,className:d,children:[(0,l.jsx)(J,{as:"h1",variant:"h4",children:g("component.WorkAttachmentModal.title")}),(0,l.jsx)(X,{onClose:o,onSubmit:S}),(0,l.jsx)(v.Z,{error:k||I,dissmiss:function(){return{individual:w,group:L}[e]()}})]})})).withConfig({componentId:"sc-ef29501b-2"})(Q())}}]);
//# sourceMappingURL=9251-85eb08e8e450f032.js.map